<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Dashboard - SevaSphere</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* --- Global Styles --- */
body{
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    background: #0B132B; /* deep navy */
    color:#fff;
}

.dashboard{
    display:flex;
    min-height:100vh;
}

/* --- Sidebar --- */
.sidebar{
    width:260px;
    background:#1F254F; /* darker navy */
    padding:25px;
    color:white;
    box-shadow:2px 0 15px rgba(0,0,0,0.3);
}
.sidebar h2{
    margin-bottom:40px;
    font-size:24px;
    color:#00BFA6; /* teal accent */
}
.sidebar a{
    display:block;
    color:white;
    text-decoration:none;
    padding:12px 0;
    transition:0.3s;
    font-size:16px;
    opacity:0.9;
}
.sidebar a:hover{
    transform:translateX(5px);
    opacity:1;
    color:#00BFA6;
}

/* --- Main Content --- */
.main{
    flex:1;
    padding:40px;
    background:#F8FAFF; /* clean white background */
    color:#0B132B;
    overflow-y:auto;
}

.topbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
    gap:20px;
}

.profileBox{
    background:#00BFA6; /* teal box */
    color:#fff;
    padding:20px 25px;
    border-radius:12px;
    box-shadow:0 8px 25px rgba(0,0,0,0.15);
    margin-bottom:25px;
}
.profileBox h2{
    margin:0;
    font-size:22px;
}
.profileBox p{
    margin:6px 0 0;
    font-size:15px;
}

/* --- Cards --- */
.cards{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
    gap:18px;
}
.card{
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 5px 20px rgba(0,0,0,0.1);
    color:#0B132B;
}
.card h3{
    margin:0;
    font-size:16px;
    color:#555;
}
.card h2{
    margin:12px 0 0;
    font-size:34px;
    color:#1F254F; /* darker navy for numbers */
}

/* --- Buttons --- */
.actionButtons{
    margin-top:25px;
    display:flex;
    gap:15px;
    flex-wrap:wrap;
}
.btn{
    border:none;
    padding:12px 18px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    font-size:15px;
    transition:0.3s;
}
.btnPrimary{
    background:#1F254F;
    color:white;
}
.btnSecondary{
    background:#fff;
    color:#1F254F;
    border:2px solid #1F254F;
}
.btn:hover{
    opacity:0.85;
}

/* Scrollbar Styling */
.main::-webkit-scrollbar{
    width:8px;
}
.main::-webkit-scrollbar-thumb{
    background:#00BFA6;
    border-radius:8px;
}
.main::-webkit-scrollbar-track{
    background:#F8FAFF;
}
</style>
</head>

<body>

<div class="dashboard">

    <div class="sidebar">
        <h2>üåç SevaSphere</h2>

        <a href="admin-dashboard.html">Dashboard</a>
        <a href="create-event.html">Create Event</a>
        <a href="view-volunteers.html">View Volunteers</a>
        <a href="attendance.html">Attendance</a>

        <br>
        <a href="#" id="logoutBtn">Logout</a>
    </div>

    <div class="main">

        <div class="topbar">
            <h1 style="margin:0;">Admin Dashboard</h1>
        </div>

        <div class="profileBox">
            <h2 id="adminName">Loading...</h2>
            <p>Manage events, track volunteers, and monitor participation in SevaSphere üíö</p>
        </div>

        <div class="cards">
            <div class="card">
                <h3>Total Events</h3>
                <h2 id="totalEvents">0</h2>
            </div>

            <div class="card">
                <h3>Upcoming Events</h3>
                <h2 id="upcomingEvents">0</h2>
            </div>

            <div class="card">
                <h3>Total Volunteers</h3>
                <h2 id="totalVolunteers">0</h2>
            </div>

            <div class="card">
                <h3>Total Applications</h3>
                <h2 id="totalApplications">0</h2>
            </div>
        </div>

        <div class="actionButtons">
            <button class="btn btnPrimary" onclick="window.location.href='create-event.html'">
                + Create New Event
            </button>

            <button class="btn btnSecondary" onclick="window.location.href='view-volunteers.html'">
                View Applications
            </button>

            <button class="btn btnSecondary" onclick="window.location.href='attendance.html'">
                Mark Attendance
            </button>
        </div>

    </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-z1Zx-0qAj6_FGiclcXFdIjiKSjXlUKw",
  authDomain: "sevasphere-6dce7.firebaseapp.com",
  projectId: "sevasphere-6dce7",
  storageBucket: "sevasphere-6dce7.appspot.com",
  messagingSenderId: "930986469572",
  appId: "1:930986469572:web:7c62c3e6ff7c3f90d98191"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

function isUpcoming(dateStr){
    if(!dateStr) return false;
    const today = new Date();
    today.setHours(0,0,0,0);
    const eventDate = new Date(dateStr);
    eventDate.setHours(0,0,0,0);
    return eventDate >= today;
}

onAuthStateChanged(auth, async (user)=>{
    if(!user){ window.location.href="admin-login.html"; return; }

    const userDoc = await getDoc(doc(db,"users",user.uid));
    if(!userDoc.exists() || userDoc.data().role !== "admin"){
        window.location.href="../index.html";
        return;
    }

    document.getElementById("adminName").innerText = "Welcome, " + userDoc.data().name + " üëã";

    const eventsSnap = await getDocs(collection(db,"events"));
    document.getElementById("totalEvents").innerText = eventsSnap.size;

    let upcomingCount = 0;
    eventsSnap.forEach((docItem)=>{
        if(isUpcoming(docItem.data().date)) upcomingCount++;
    });
    document.getElementById("upcomingEvents").innerText = upcomingCount;

    const usersSnap = await getDocs(collection(db,"users"));
    let volunteerCount = 0;
    usersSnap.forEach((u)=>{
        if(u.data().role === "volunteer") volunteerCount++;
    });
    document.getElementById("totalVolunteers").innerText = volunteerCount;

    try{
        const appsSnap = await getDocs(collection(db, "applications"));
        document.getElementById("totalApplications").innerText = appsSnap.size;
    }catch(err){
        document.getElementById("totalApplications").innerText = 0;
        console.log("Applications collection not found yet:", err.message);
    }
});

document.getElementById("logoutBtn").addEventListener("click", async (e)=>{
    e.preventDefault();
    await signOut(auth);
    window.location.href="../index.html";
});
</script>

</body>
</html>
